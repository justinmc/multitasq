var Multitasq=function(){function t(){this.sandbox=new t.Sandbox(this),this.router=new t.Router(this),Backbone.history.start({pushState:!1}),this.createEvents()}return t.Router=null,t.Sandbox=null,t.TaskView=null,t.TaskList=null,t.Task=null,t.prototype.sandbox=null,t.prototype.helpShown=!1,t.prototype.createEvents=function(){var t=this;$(".helpToggle").on("click",function(e){t.helpShown?t.router.navigate("",{trigger:!0}):t.router.navigate("help",{trigger:!0}),e.preventDefault()})},t.prototype.helpShow=function(){this.sandbox.clear(),$("#content_tasksvg").hide(),$("#content_overlay").show(),this.helpShown=!0},t.prototype.helpHide=function(){this.sandbox.render(),$("#content_tasksvg").show(),$("#content_overlay").hide(),this.helpShown=!1},t}();
Multitasq.Task=Backbone.Model.extend({defaultTitle:"New Task",defaults:function(){var t=Date.now();return{kind:"tasks#task",id:"0",etag:"0",title:this.defaultTitle,updated:t,selfLink:"0",parent:-1,position:"0",status:"needsAction",completed:null,created:t,archived:null,description:"",children:[],level:0,minimized:!1,upped:!1}},initialize:function(){this.get("title")||(this.set({title:this.defaults.title}),this.set({title:this.defaults.parent})),this.bind("change",this.update)},update:function(){this.save({updated:Date.now()},{silent:!0})},toggleMinimized:function(){this.save(this.get("minimized")===!1?{minimized:!0}:{minimized:!1})},toggleUpdown:function(){this.save(this.get("upped")===!1?{upped:!0}:{upped:!1})},toggleCompleted:function(){null===this.get("completed")?this.setCompleted():this.setIncomplete()},setCompleted:function(){var t=Date.now();this.save({completed:t})},setCompletedSubtree:function(){this.trigger("completed",this)},setIncomplete:function(){Date.now();this.save({completed:null})},setIncompleteSubtree:function(){this.trigger("restored",this)},setArchivedSubtree:function(){var t=Date.now();this.save({archived:t}),this.trigger("archived",this)},dateToGoogleTasks:function(t){return t=t.getUTCFullYear()+"-"+t.getUTCMonth()+"-"+t.getUTCDate()+"T"+t.getUTCHours()+":"+t.getUTCMinutes()+":"+t.getUTCSeconds()+".000Z"},getCreatedHuman:function(){return this.dateToHuman(this.get("created"))},getUpdatedHuman:function(){return this.dateToHuman(this.get("updated"))},dateToHuman:function(t){var e=new Date(t);return"[object Date]"===Object.prototype.toString.call(e)&&isNaN(e.valueOf())?"":e.toLocaleTimeString()+" "+e.toLocaleDateString()},clear:function(){this.destroy()}});
Multitasq.TaskList=Backbone.Collection.extend({model:Multitasq.Task,localStorage:new Backbone.LocalStorage("multitasq-backbone"),top:null,initialize:function(e){this.bind("reset",function(){this.collectionUpdated(e)}),this.bind("add",function(){this.collectionUpdated(e)}),this.bind("remove",function(e){var t=this.get(e.get("parent"));if("undefined"!=typeof t){var i=t.get("children");i.splice($.inArray(e.get("id"),i),1),t.save({children:i})}Backbone.sync("delete",e,{success:function(){},error:function(){}})}),this.bind("completed",function(e){this.setCompletedSubtree(e)}),this.bind("archived",function(t){this.removeSubtree(t,e)}),this.bind("restored",function(e){this.setIncompleteSubtree(e)})},collectionUpdated:function(e){this.top=null,this.length||this.create({id:this.newId(),title:"Conquer the world"});var t=this,i=[];if(this.each(function(e){var n=t.get(e.get("parent")),r="undefined"==typeof n||-1===n?0:n.get("level")+1;if(e.save({level:r}),("undefined"==typeof n||-1===n)&&i.push(e.get("id")),-1!==i.indexOf(e.get("id"))||e.get("upped")){var o=null===t.top?-1/0:t.get(t.top).get("level");e.get("level")>o&&(t.top=e.get("id"))}if("undefined"!=typeof n&&-1!==n){{var s=n.get("children");e.get("id")}-1===$.inArray(e.get("id"),s)&&(s.push(e.get("id")),n.save({children:s}))}}),i.length>1){var n=this.newId();for(var r in i)this.get(i[r]).save({parent:n});this.top=n,this.create({id:n,parent:-1,title:"Conquer the world"})}this.isValidTree()?e.render():(alert("Error: Invalid data in localstorage, click OK to clear"),localStorage.clear(),this.reset())},isValidTree:function(){var e=!0;null===this.top&&(e=!1);var t=this;return this.each(function(i){var n=i.get("children");for(var r in n)"undefined"==typeof t.get(n[r])&&(e=!1)}),e},newId:function(){for(var e=this.length?parseInt(this.get(this.at(this.length-1)).get("id")):0,t=e+1,i=!0;i;)this.get(t)||(i=!1),t++;return t},removeSubtree:function(e,t){this.removeSubtreeRecurse(e),this.collectionUpdated(t)},removeSubtreeRecurse:function(e){for(e.get("children");e.get("children").length;){var t=this.get(e.get("children")[0]);this.removeSubtreeRecurse(t)}this.remove(e)},setIncompleteSubtree:function(e){for(var t=e.get("children"),i=0;i<t.length;i++){var n=this.get(t[i]);this.setIncompleteSubtree(n)}e.setIncomplete()},setCompletedSubtree:function(e){for(var t=e.get("children"),i=0;i<t.length;i++){var n=this.get(t[i]);this.setCompletedSubtree(n)}e.setCompleted()},getAtLevel:function(e){var t=this,i=[];return this.each(function(n){t.getLevel(n)===e&&i.push(n)}),i},getParent:function(e){return this.get(e.get("parent"))},getLevel:function(e){return-1===e.get("parent")||"undefined"==typeof e.get("parent")?0:this.getLevel(this.getParent(e))+1},getHeight:function(e){var t=e.get("children");if(0===t.length||e.get("minimized")===!0)return 0;var i=0;for(var n in t){var r=this.getHeight(this.get(t[n]));r>i&&(i=r)}return i+1},getNearestCommonAncestor:function(e,t){var i=e.get("level"),n=t.get("level");return e.get("id")===t.get("id")?e:i!==n&&i>n?this.getNearestCommonAncestor(e,this.get(t.get("parent"))):this.getNearestCommonAncestor(this.get(e.get("parent")),this.get(t.get("parent")))}});
Multitasq.TaskListArchived=Backbone.Collection.extend({model:Multitasq.Task,localStorage:new Backbone.LocalStorage("multitasq-backbone-archived")});
Multitasq.Sandbox=Backbone.View.extend({el:$("#content_tasksvg"),tasks:null,taskWidth:150,taskHeight:60,taskSpacing:20,taskLeftmost:1/0,taskRightmost:0,taskBottommost:0,taskTitleLength:18,scaleDownStep:.6,translation:0,mousestopTimer:null,colorActiveFill:"green",colorInactiveFill:"#ffffff",colorSelectedStroke:"green",colorUnselectedStroke:"#afafaf",nearest:-1,events:{mouseenter:"sandboxEnter",mouseleave:"sandboxLeave",mousemove:"updateTaskSelected","mouseenter #content_tasksvg_bg":"sandboxBgEnter","click #content_tasksvg_bg":"clickAdd","click .content_tasksvg_task_close":"clickRemove","click .content_tasksvg_task_minimize":"clickMinimize","click .content_tasksvg_task_updown":"clickUpdown","click .content_tasksvg_task_text":"clickReviveEdit","click .content_tasksvg_task_box":"clickReviveEdit","click .content_tasksvg_task_textfield_submit":"clickSubmit","mouseenter .content_tasksvg_task_box":"enterTask","mouseenter .content_tasksvg_task_close":"enterTask","mouseenter .content_tasksvg_task_text":"enterTask","submit .content_tasksvg_task_textfield_form":"clickSubmit",keyup:"keypress"},initialize:function(t){this.app=t,this.tasks=new Multitasq.TaskList(this),this.tasks.fetch(),this.tasks.length||this.tasks.reset();var e=this;this.listenTo(this.tasks,"change",function(){e.tasks.collectionUpdated(e)}),$(window).on("resize",function(){e.render()})},clear:function(){$(this.el).empty(),this.taskLeftmost=1/0,this.taskRightmost=0,this.taskBottommost=0;var t=document.createElementNS("http://www.w3.org/2000/svg","g");t.setAttribute("id","content_tasksvg_group"),$(this.el).append(t);var e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("id","content_tasksvg_bg"),e.setAttribute("width","100%"),e.setAttribute("height","100%"),$(t).append(e)},sandboxEnter:function(t){this.nearest=this.nearestTask(t.pageX,t.pageY-$(this.el).offset().top),this.setTaskSelected(this.nearest)},sandboxLeave:function(){$(".content_tasksvg_task_box").css("stroke","#afafaf"),$(".content_tasksvg_task_box").css("fill","#ffffff")},sandboxBgEnter:function(){this.setTaskInactive()},updateTaskSelected:function(t){if($("#content_tasksvg_bg:hover")){var e=$("#content").width(),s=$("#content").height(),a=this.getViewBoxWidth(),i=this.getViewBoxHeight(),n=t.pageX*a/e,o=(t.pageY-$(this.el).offset().top)*i/s,r=this.nearestTask(n,o);r!=this.nearest&&(this.setTaskSelected(r),this.nearest=r)}},clickAdd:function(){if($(".content_tasksvg_task_textfield").length)this.editTaskConfirmAll();else if(!this.tasks.get(this.nearest).get("minimized")){var t=this.tasks.newId();this.tasks.create({id:t,parent:this.nearest}),this.editTaskInline(t)}},clickRemove:function(t){var e=this.tasks.get($(t.target).parent().data("task"));e.get("completed")?this.tasks.removeSubtree(e,this):this.tasks.setCompletedSubtree(e)},clickMinimize:function(t){var e=this.tasks.get($(t.target).parent().data("task"));e.get("children").length>0&&e.toggleMinimized()},clickUpdown:function(t){var e=this.tasks.get($(t.target).parent().data("task"));e.toggleUpdown()},clickReviveEdit:function(t){{var e=$(t.target).parent().data("task");this.tasks.get(e)}$(".content_tasksvg_task_textfield").length&&this.editTaskConfirmAll(),this.editTask(e)},clickSubmit:function(){return this.editTaskConfirmAll(),!1},enterTask:function(t){var e=$(t.target).data("id")?$(t.target).data("task"):$(t.target).parent().data("task");this.setTaskActive(e)},keypress:function(t){27===t.keyCode&&this.editTaskCancel()},editTask:function(t){var e=this.tasks.get(t);this.app.router.navigate("leaf/"+e.id,{trigger:!0})},editTaskInline:function(t){var e=this.tasks.get(t),s=$(".content_tasksvg_task_text.task"+t);s.get(0).textContent="";var a=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");a.setAttribute("class","content_tasksvg_task_textfield task"+s.parent().data("task")),a.setAttribute("data-task",s.parent().data("task")),a.setAttribute("x",s.attr("x")),a.setAttribute("y",s.attr("y")-20),a.setAttribute("width",this.taskWidth-10),a.setAttribute("height","50");var i=document.createElement("body");i.setAttribute("xmlns","http://www.w3.org/1999/xhtml");var n=document.createElement("form");n.setAttribute("class","content_tasksvg_task_textfield_form");var o=document.createElement("input");o.setAttribute("type","text"),o.setAttribute("value",e.get("title")),o.setAttribute("style","width: "+(this.taskWidth-22)+"px");var r=document.createElement("input");r.setAttribute("type","submit"),r.setAttribute("value","Edit"),r.setAttribute("class","content_tasksvg_task_textfield_submit"),r.setAttribute("hidden","hidden"),n.appendChild(o),n.appendChild(r),i.appendChild(n),a.appendChild(i),$(this.el).append(a);var k=$(".content_tasksvg_task_textfield.task"+s.parent().data("task")).find("input[type=text]").get(0);k.select()},editTaskCancel:function(){if($(".content_tasksvg_task_textfield").length){var t=this;$(".content_tasksvg_task_textfield").each(function(){var e=$(this).data("task"),s=$(".content_tasksvg_task_text.task"+e);s.get(0).textContent=t.tasks.get(e).get("title").substring(0,t.taskTitleLength)+"...",$(this).remove()})}},editTaskConfirmAll:function(){var t=this;$(".content_tasksvg_task_textfield").length&&$(".content_tasksvg_task_textfield").each(function(){var e=$(this).data("task"),s=$(this).find("input[type=text]"),a=t.tasks.get(e);$(s).val()!==a.get("title")?a.save({title:$(s).val()}):($(".content_tasksvg_task_text.task"+e).get(0).textContent=a.get("title"),$(this).remove())})},setTaskActive:function(t){this.tasks.get(t);$(".content_tasksvg_task_box").css("fill",this.colorInactiveFill),$(".content_tasksvg_task_box.task"+t).css("fill",this.colorActiveFill)},setTaskInactive:function(t){var e="undefined"==typeof t?"":".task"+t;if($(".content_tasksvg_task_box"+e).css("fill","#ffffff"),$(".content_tasksvg_task_text"+e).text(a),"undefined"!=typeof t){var s=this.tasks.get(t),a=s.get("title").substring(0,this.taskTitleLength)+"...";$(".content_tasksvg_task_text"+e).text(a)}},setTaskSelected:function(t){$(".content_tasksvg_task_box").css("stroke",this.colorUnselectedStroke),$(".content_tasksvg_task_box.task"+t).css("stroke",this.colorSelectedStroke)},setTaskUnselected:function(t){var e="undefined"==typeof t?"":".task"+t;$(".content_tasksvg_task_box"+e).css("stroke",this.colorUnselectedStroke)},render:function(){var t=this;this.clear(),this.renderSubtree(this.tasks.top),this.bushifyTree(this.tasks.top);var e=this.getViewBoxWidth()*this.scaleDownStep,s=this.getViewBoxHeight()*this.scaleDownStep,a=this.taskRightmost-this.taskLeftmost,i=this.taskBottommost+2*this.taskSpacing;this.taskLeftmost<=0||this.taskRightmost>this.getViewBoxWidth()||i>this.getViewBoxHeight()?t.scale(1/this.scaleDownStep):e>a&&s>i&&this.taskWidth/e<.12&&t.scale(this.scaleDownStep)},renderSubtree:function(t){var e=this.tasks.get(t),s=new Multitasq.TaskView(e);if(s.render(this),!e.get("minimized")){var a=e.get("children");for(var i in a)this.renderSubtree(a[i]);if(!a.length){var n=parseInt($(".content_tasksvg_task_box.task"+t).attr("y"))+this.taskHeight;n>this.taskBottommost&&(this.taskBottommost=n)}}},bushifyTree:function(t){var e=$(".content_tasksvg_task.task"+t).data("children")||[],s={left:this.taskWidth/2+this.taskSpacing/2,right:this.taskWidth/2+this.taskSpacing/2};if(e.length>0){for(var a=[],i=0,n=0;n<e.length;n++){var o=this.bushifyTree(e[n]);a.push(o),i=i+o.left+o.right}s={left:i/2,right:i/2};var r=parseInt($(".content_tasksvg_task_box.task"+t).attr("x"))+this.taskWidth/2,k={left:r-s.left,right:r+s.right};if(k.left<this.taskLeftmost&&(this.taskLeftmost=k.left),k.right>this.taskRightmost&&(this.taskRightmost=k.right),e.length>1){var c=i/2*-1+this.taskWidth/2;for(n=0;n<e.length;n++){var h=c+a[n].left-this.taskWidth/2;this.translateTreeBy(e[n],h),c=c+a[n].left+a[n].right}}}return s},translateTreeBy:function(t,e){var s=$(".content_tasksvg_task.task"+t).data("children"),a=parseInt($(".content_tasksvg_task_box.task"+t).attr("x"));if(this.moveTaskTo(t,a+e),"undefined"!=typeof s)for(var i=0;i<s.length;i++)this.translateTreeBy(s[i],e)},scale:function(t){var e=this.getViewBoxWidth(),s=this.getViewBoxHeight();e=Math.round(e*t),s=Math.round(s*t),$(this.el)[0].setAttribute("viewBox","0 0 "+e+" "+s),this.render()},moveTaskTo:function(t,e){$(".content_tasksvg_task_box.task"+t).get(0).setAttribute("x",e),$(".content_tasksvg_task_text.task"+t).get(0).setAttribute("x",e+5),$(".content_tasksvg_task_close.task"+t).get(0).setAttribute("x",e+this.taskWidth-16),$(".content_tasksvg_task_updown.task"+t).get(0).setAttribute("x",e+this.taskWidth-54),$(".content_tasksvg_task_minimize.task"+t).get(0).setAttribute("x",e+this.taskWidth-32);var s=parseInt($(".content_tasksvg_task_box.task"+$(".content_tasksvg_task.task"+t).data("parent")).attr("x"));$(".content_tasksvg_connector.task"+t).get(0).setAttribute("x1",s+this.taskWidth/2),$(".content_tasksvg_connector.task"+t).get(0).setAttribute("x2",e+this.taskWidth/2),$(".content_tasksvg_task_textfield.task"+t).length&&$(".content_tasksvg_task_textfield.task"+t).get(0).setAttribute("x",e+5)},nearestTask:function(t,e){var s,a=1/0,i=this;return $(".content_tasksvg_task:not(.pending) > .content_tasksvg_task_box").each(function(){var n=i.nearestTaskPoint($(this).parent().data("task"),t,e),o=i.distance(n[0],n[1],t,e);a>o&&e>n[1]&&(a=o,s=$(this).parent().data("task"))}),"undefined"==typeof s&&(s=this.tasks.top),s},nearestTaskPoint:function(t,e,s){var a,i=$(".content_tasksvg_task_box.task"+t),n=parseInt($(i).attr("y")),o=parseInt($(i).attr("x"))+this.taskWidth,r=parseInt($(i).attr("y"))+this.taskHeight,k=parseInt($(i).attr("x"));a=k>e?k:e>o?o:e;var c;return c=n>s?n:s>r?r:s,[a,c]},getViewBoxWidth:function(){if(null===$(this.el)[0].getAttribute("viewBox"))return $("#content").width();var t=$(this.el)[0].getAttribute("viewBox");return t=t.substring(t.indexOf(" ")+1,t.length),t=t.substring(t.indexOf(" ")+1,t.length),parseInt(t.substring(0,t.indexOf(" ")))},getViewBoxHeight:function(){if(null===$(this.el)[0].getAttribute("viewBox"))return $("#content").height();var t=$(this.el)[0].getAttribute("viewBox");return t=t.substring(t.indexOf(" ")+1,t.length),t=t.substring(t.indexOf(" ")+1,t.length),parseInt(t.substring(t.indexOf(" ")+1,t.length))},getTaskMidX:function(t){return-1===t?0:parseInt($(".content_tasksvg_task_box.task"+t).attr("x"))+parseInt($(".content_tasksvg_task_box.task"+t).attr("width"))/2},getTaskMidBotY:function(t){return-1===t?0:parseInt($(".content_tasksvg_task_box.task"+t).attr("y"))+parseInt($(".content_tasksvg_task_box.task"+t).attr("height"))},getTaskMidTopY:function(t){return parseInt($(".content_tasksvg_task_box.task"+t).attr("y"))},distance:function(t,e,s,a){return Math.sqrt(Math.pow(t-s,2)+Math.pow(e-a,2))},removeClassSVG:function(t,e){var s=$(t).attr("class"),a=s.search(e);s=s.substring(0,a)+s.substring(a+e.length,s.length),$(t).attr("class",s)},hasClassSVG:function(t,e){var s=$(t).attr("class"),a=s.search(e);return-1===a?!1:!0}});
Multitasq.TaskView=Backbone.View.extend({el:null,task:null,events:{},initialize:function(t){this.task=t,this.el=$(".content_tasksvg_task.task"+t.get("id"))},render:function(t){var e=this.task.get("id"),s=this.task.get("parent"),a=this.task.get("dontSync")?!0:!1,i=this.task.get("title");i.length>t.taskTitleLength&&(i=i.substring(0,t.taskTitleLength-1),i+="...");var n=this.task.get("completed")?.3:1,r=t.getViewBoxWidth()/2-t.taskWidth/2,k=4,d=0;-1==s||this.task.get("upped")||(k=parseInt($(".content_tasksvg_task_box.task"+s).attr("y"))+100,d=parseInt(t.tasks.get(s).get("level"))+1);var g=document.createElementNS("http://www.w3.org/2000/svg","g"),c=a?" pending":"";g.setAttribute("class","content_tasksvg_task task"+e+c),g.setAttribute("style","opacity: "+n+";");var h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttribute("class","content_tasksvg_task_box task"+e),h.setAttribute("x",r),h.setAttribute("y",k),h.setAttribute("rx","10"),h.setAttribute("ry","10"),h.setAttribute("width",t.taskWidth),h.setAttribute("height",t.taskHeight),g.appendChild(h);var o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("class","content_tasksvg_task_text task"+e),o.setAttribute("x",r+5),o.setAttribute("y",k+40);var u=document.createTextNode(i);if(o.appendChild(u),g.appendChild(o),-1!=s){var l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("class","content_tasksvg_task_updown task"+e),l.setAttribute("x",r+t.taskWidth-54),l.setAttribute("y",k+16),l.setAttribute("textLength",0);var p=document.createTextNode(this.task.get("id")==t.tasks.top?"↓":"↑");l.appendChild(p),g.appendChild(l)}var v="";this.task.get("children").length<=0&&(v="hidden");var _=document.createElementNS("http://www.w3.org/2000/svg","text");_.setAttribute("class","content_tasksvg_task_minimize task"+e+" "+v),_.setAttribute("x",r+t.taskWidth-36),_.setAttribute("y",k+16),_.setAttribute("textLength",0);var b=document.createTextNode(this.task.get("minimized")?"+":"-");_.appendChild(b),g.appendChild(_);var w=document.createElementNS("http://www.w3.org/2000/svg","text");w.setAttribute("class","content_tasksvg_task_close task"+e),w.setAttribute("x",r+t.taskWidth-16),w.setAttribute("y",k+16),w.setAttribute("textLength",20);var A=document.createTextNode("✓");if(w.appendChild(A),g.appendChild(w),-1!=s&&!this.task.get("upped")){var m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("class","content_tasksvg_connector task"+s+" task"+e),m.setAttribute("x1",t.getTaskMidX(s)),m.setAttribute("y1",t.getTaskMidBotY(s)),m.setAttribute("x2",r+t.taskWidth/2),m.setAttribute("y2",k),g.appendChild(m)}$("#content_tasksvg_group").append(g),$(".content_tasksvg_task.task"+e).data("task",e),$(".content_tasksvg_task.task"+e).data("parent",s),$(".content_tasksvg_task.task"+e).data("children",this.task.get("minimized")?[]:this.task.get("children")),$(".content_tasksvg_task.task"+e).data("level",d)}});
Multitasq.Modal=Backbone.View.extend({template:_.template($("script.template-modal").html()),parentSelector:".modal-view",task:null,events:{"click .modal-background":"close","click .close":"close","click .minimize":"minimize","click .maximize":"maximize","click .up":"up","click .down":"down","click .complete":"complete","click .restore":"restore","click .archive":"archive","keyup body":"keyup"},initialize:function(t){this.app=t.app,this.task=t.task;var e=this;this.listenTo(this.task,"change",function(){e.render()}),this.keyupBound=this.keyup.bind(this),$("body").on("keyup",this.keyupBound),this.render()},render:function(){return this.$el=$(this.template({title:this.task.get("title"),description:this.task.get("title"),upped:this.task.get("upped"),minimized:this.task.get("minimized"),completed:!!this.task.get("completed"),childrenLength:this.task.get("children").length,top:-1===this.task.get("parent"),created:this.task.getCreatedHuman(),updated:this.task.getUpdatedHuman()})),$(this.parentSelector).html(this.$el),this.editTitle=new Multitasq.EditableInput({task:this.task,attribute:"title",parentSelector:".editable-input.title"}),this.editDescription=new Multitasq.EditableInput({task:this.task,attribute:"description",parentSelector:".editable-input.description","long":!0}),this.task.get("title")===this.task.defaultTitle&&(this.editTitle.editing=!0,this.editTitle.render()),this.delegateEvents(),this},show:function(){},close:function(){$("body").off("keyup",this.keyupBound),this.app.router.navigate(""),this.remove()},minimize:function(){this.task.save({minimized:!0}),this.close()},maximize:function(){this.task.save({minimized:!1}),this.close()},up:function(){this.task.save({upped:!0}),this.close()},down:function(){this.task.save({upped:!1}),this.close()},complete:function(){this.task.setCompletedSubtree(),this.close()},restore:function(){this.task.setIncompleteSubtree(),this.close()},archive:function(){this.task.setArchivedSubtree(),this.close()},keyup:function(t){(27===t.which||13===t.which)&&this.close()}});
Multitasq.EditableInput=Backbone.View.extend({template:_.template($("script.template-editable-input").html()),parentSelector:null,defaultValue:"Click to edit",editing:!1,events:{"click .editable":"edit","click .save":"save","click .cancel":"close","keyup .edit":"inputKeyup"},initialize:function(t){this.task=t.task,this.attribute=t.attribute,this.parentSelector=t.parentSelector,t.long&&(this.template=_.template($("script.template-editable-input-long").html())),this.render()},render:function(){var t=this.template({value:this.task.get(this.attribute),defaultValue:this.defaultValue,editing:this.editing});return this.$el=$(this.parentSelector).html(t),this.delegateEvents(),this.editing&&this.$el.find(".edit").get(0).select(),this},edit:function(){this.editing=!0,this.render()},close:function(){this.editing=!1,this.render()},save:function(){var t={};t[this.attribute]=this.$el.find(".edit").val(),this.task.save(t),this.close()},inputKeyup:function(t){27===t.which?(this.close(),t.stopPropagation()):13===t.which&&(this.save(),t.stopPropagation())}});
Multitasq.Router=Backbone.Router.extend({routes:{"":"main",help:"help","leaf/:id":"leaf","*path":"main"},initialize:function(t){this.app=t},main:function(){this.app.helpHide()},help:function(){this.app.helpShow()},leaf:function(t){new Multitasq.Modal({task:this.app.sandbox.tasks.get(t),app:this.app})}});
$(function(){window.multitasq=new Multitasq});